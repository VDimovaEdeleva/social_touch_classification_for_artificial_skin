function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 29-Jan-2019 23:50:04.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 78xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 10xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 76 77 78];
x1_step2.xoffset = [0.000578675924410775;0.00682068;0.0023745788721519;2.24643236111111e-06;0;2.02602818518519e-05;0.000109905709814815;3.61972422222222e-05;1.03844536111111e-05;7.57288490740741e-06;0.000111346805277778;1.89887157407407e-05;9.51554777777778e-06;0;1.43670454545455e-07;0.000121064622348485;0;0.00022979509530303;1.71066950974026e-05;2.88992424242424e-07;0;0;5.01707066233767e-05;0.0101010101010101;0.0101010101010101;1;3;80;0.606228956228956;0;0;0;0;0;0;0;0.00357142857142857;0;7.46714354532815e-07;1.19780358345358e-06;0.00325520666666667;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;7.21500721500722e-05;0.0101010101010101;0;0;80;0.9;0;0;0;0.00357142857142857;0;1.30567289501568e-08];
x1_step2.gain = [7.52459518511502;2.01376545625401;1.17321886519955;5.42330663173617;4.52600246025657;5.74355226602388;4.78421152855844;6.09059218759192;5.19187572088299;4.51233993282465;4.90684413304077;5.4344860216347;5.51861923815961;5.2544601980379;5.62509850208666;3.29158638372425;2.92418690298227;5.39840954505524;7.53554432994659;5.12599700114267;3.4080398698239;4.19998877238001;4.15608162026694;5.90310559006211;6;0.0298507462686567;0.0087719298245614;0.01;5.07909362975631;9.2093023255814;49.3970893970894;61.4634146341463;38.8235294117647;42.5806451612903;33.9914163090129;12.2981366459627;0.112540192926045;0.0145880767798847;16.7894175964496;26.4372125270515;4.20533713634119;15.2002401227469;21.7528804912577;22.9533648442156;23.7158159076655;29.0290576369233;28.99303315355;20.1208051964069;30.5761740259931;27.3984472620049;23.6511509198978;24.7366970518193;24.1754037014009;22.0141520361231;28.4389593652184;25.2335997309028;26.8447914388326;23.5844524114313;18.7806371949222;27.7713931722796;24.210421326094;29.6578228686529;4.82031068861582;4.4;0.0206185567010309;0.00714285714285714;0.01;20;20;528;1827.69230769231;0.224809313528703;0.224971878515185;1205.11856669701];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.3238349384513548035;0.71110042529991013271;-1.5462985616096931452;1.2006126277426631965;0.99046161005910049457;-0.30574897355187624637;-0.65042905422941965643;1.3986777146509807856;-1.5960272398546735406;-0.96164096969498846779];
IW1_1 = [0.16526776474991911048 0.44546980175123190859 -2.4561319206857894493 0.035580830571572574783 0.72775660845863787696 -0.39709794135687148664 -0.082908017907069989083 -0.51801732805028455342 -0.072739494558053507944 0.25796107980485866173 -0.23016283935029688279 0.56371990056943210856 0.25936872481953998637 -0.51167002027953145671 0.097018981788388899967 -0.26410363419813714936 -0.075634228706720776914 0.43553556140000260211 -0.16275227875807996014 0.13330431741925005684 0.35355058724344468057 0.043528261611599929071 0.12682896961431289196 0.81229094422443126611 -1.0569875466969300692 -1.0877595428056479054 -1.4088760646087195028 0.4201212117217977271 -0.33424411438693496512 0.067579549552325826611 -0.22863741099449416683 0.13093121799208179423 -0.45437368001119249339 0.16598524128146471823 0.12523258578093129922 0.16198042944982141145 0.51599357979069138125 -0.47143069673686466281 -0.00025039073918023575793 -0.053723914825533188033 2.0081424335902231526 -0.37055695467628607664 -0.10252170616715641782 -0.15657291807334600131 -0.40883147460231106241 0.13266964079376958319 -0.26098881815728247613 -0.46302100681350971678 0.28918123705045678529 0.11173736911241516356 0.57916481542490350076 -0.19793165022441533418 -0.14403116590043521517 -0.011525986601621525385 0.12143028739715341913 0.032110426830491256567 -0.065756141423958913705 -0.29294356989336067798 -0.0011626674018344663498 -0.22180546802060777112 -0.30418665153239032861 0.22227014873223199798 -0.21776475716386350934 -0.39885017533115235677 0.3122145203085039955 -0.52044082160533799986 0.57671768800348477413 0.097124376602442524797 -0.085388560028752336084 -0.14175360667862060837 -0.22045739178201023689 1.2433329956807279704 0.43835220853097650595 0.34121626583082925732;-0.19279200376168473263 -0.050363717385624950929 0.14280480867318454119 -0.12151876379597699451 -0.012793557244293290998 0.016270643047583941559 -0.17919958887417075655 -0.20870184580933368035 -0.0072492607958044652863 0.13507326601013355805 -0.069450499775098900601 -0.31258770779005412566 -0.046692622847794816587 0.016770731959739021422 0.46910707384632260863 -0.082263130914840415508 0.39844106451034883021 -0.039321816464730069418 -0.060614284035562987496 -0.047943897691619961898 0.4020786029535356465 -0.0036716721724723748801 0.27407265632754773677 0.2004497198965204674 0.063953035822156056867 -0.33405544744425785808 -1.3737852095239793115 -2.907520720704259265 0.25541961700497889387 -0.17926247175293422154 -0.24885559415705160724 0.078505826296350070259 0.30625165640360807462 0.45388054144427325554 0.21109912598605512501 0.15400294938794398258 0.0026348735401349734561 0.0067472039990161564865 0.14555682045296688965 -0.055096552583965771599 0.40033990568481453431 0.38438049179370908925 0.13371115935186470014 0.058391188024017187663 0.27658148645142804911 0.28114335917438004753 0.41235704109864612654 0.40602644774088519908 0.19733258519777996387 0.40178494244897539067 -0.15134035965424810777 0.11978810652439771112 0.14160678564543999203 -0.055608645108187138018 0.43040107443533820453 0.12377704893230695449 0.24018799638350227243 0.42127100060761962785 0.24425794739589840043 0.16498421548169472928 0.15841781417287995049 0.17781913253142794806 0.41250762085763192921 0.24125049669981718514 -0.19318947348948226073 -0.30048342861312005159 -2.9995776200605623885 -0.013483284294904709921 0.34868679828606985449 0.1088688096754987511 0.089778580413870323618 -0.068051450255665918432 0.022445059464715453462 -0.13907893372372323593;-0.65556723544997652642 -0.68367237558069748893 -2.0252407221259778325 -0.58350181524528943466 -0.065644473766365410428 -1.2548924400083334429 -0.19595320182240061335 -0.27161121092539552979 0.44277886168268371092 -0.24371864866128878369 -0.57380671254974735529 -0.66301412701484585543 -0.095863905271340477121 -0.22258447035475972808 0.27590072408935878423 -0.23940662630259046395 -0.49275079772425406377 0.15312264835270986141 0.40751322523879440762 -0.27275732070730779322 0.31846270177261948309 -0.16347786127631827591 0.3040425621500502662 -1.1087443553844082977 0.81019767676972931358 1.5230792188325910086 -1.4197135841179333582 0.30559592959786086031 0.82388373581667750933 -0.73183441794330061914 -1.8512569060032797452 -0.73156420242215702832 -0.056945317430192030073 -0.17260708783025083268 0.3157755949771273718 0.45257318956273012711 -0.12703963729294942553 1.037398651178833342 -0.19271860140406746331 0.018803009586699948041 1.7112498163761411529 0.50785181776920773622 -0.086036604119021115045 -0.015029925558698557439 0.23069445009706054939 -0.10910248509866819766 0.26639291743547233171 0.10312760627483769094 0.0074418030656167970249 0.0009342080258348164478 0.065195879399480391458 -0.12557310899627194267 0.35894625436468707846 0.24744059877839155726 0.17767934699620266392 -0.017506530790119059771 -0.17382099030098299708 -0.18023953381915044925 0.23454545394147230386 0.031564032729539288902 0.2579775911558720991 0.37401819708264372188 -0.62306029126028283915 -0.49107623568027275462 -0.047278243950861886802 0.21096532498669579025 -0.078144116245691480627 -0.54965263535447106413 0.57289580575688603403 0.66364132309787648989 0.058335478187084906232 0.26491251073146832029 1.0114406977425682843 0.47794873794615677642;0.37280492781854340789 1.0252323234351226056 0.13314586368990888321 0.12442660202900614197 0.17872660330711639953 0.19334718683823903795 0.030438783566467786379 0.37889252177285281942 -0.059694182338855240888 0.07122323412466621817 -0.10035011201962214245 0.12128465236124565119 0.16585216791421064642 0.010631210728261505233 0.066809967336168771257 0.013983624705961044885 -0.023749700759682530748 0.18623121975662262906 -0.19217344735132327327 -0.31718298021340324278 -0.44159744386354282675 0.074604191006527556529 0.46439650088904055325 0.31511669264776837052 1.5130558332497774376 0.89177081178986927767 0.10736936169525232443 0.27849078567907814552 -0.61331010903756733033 0.36228261460714994424 0.72081497556725881992 0.21623455848557746051 -0.44884098770754610186 -0.044771449333112431357 -0.2237284969337370033 -0.084066851118891713912 0.23902372450941414272 0.04108656106088789256 0.67567013189730151801 -0.028423643929595412971 -0.21207017684807674684 -0.4757807299059393924 -0.22270135035613189411 0.040131108431808254489 -0.098452146401083601157 -0.024884261094514421864 -0.22791227387210968858 0.15885081965677727567 0.067902827809818475102 -0.28075270113378414383 -0.066552409730186043446 0.10675423590397292717 0.10748191134982028327 -0.3421030221861073306 0.03055545609692686404 0.097792773635866053761 0.22154153673001997227 -0.34194174235831636954 -0.4127600137078329956 0.0024567643385348097301 -0.31941782703228849272 -0.078504900847265191022 -0.20952874146805161581 0.35935520805521237175 0.099429164096008493257 -0.051272875996757907857 0.43807938545384844664 0.41324420198798439419 -0.22276060699266830856 0.23186312608699818916 0.1794879170468886842 -0.65148165322207951533 -0.34579649620648494901 0.12569717678483841028;0.41206265951379583701 1.3255794290536551117 -1.9236449781793685254 0.23145993587551300097 -0.10449119219196291442 0.88196199378451400896 0.27092936874065065567 0.32589363155093337143 -0.009402929766807573142 0.22277718700375317984 -0.2937278575179225748 0.58714566733118378483 0.010002748844015182939 0.34648619300119343212 0.097215789613811581793 0.15065392274214645107 0.17827106904698589163 -0.093256259923290965586 0.24524221396601833534 -0.23415277263488099013 -0.15165109820214719982 0.1176065459137784347 -0.15603375164489816096 -1.4949547260165561013 0.12459883217688161317 1.7515847361018344053 0.048365084553541971835 -0.22328128203333350021 -0.60170806539364429799 0.14692555770586288033 0.12557425939100977375 -0.081837760987387833667 -0.77815836204766475337 -0.0022186168647685194574 0.14164604163496807843 0.29917335286130186667 0.77654125168269549917 0.31926961223121563815 1.3561281895723782398 0.09347747526975989929 2.0486194407261173467 0.8220991427354811254 -0.049433569033088119171 -0.18823108088376996894 0.20341248346783699641 -0.0024440132726612959733 0.073864103546889367524 -0.18315700928961187177 0.17944987358361627616 0.15218441056380022092 -0.20482176176389410571 0.0083574483967562666897 0.029645539821060738761 0.033404232643112097279 0.042935439297916808132 -0.19483244752343789608 -0.10611142302278708804 0.090314127678900124607 -0.31259263200660869497 -0.21986655474471389349 -0.13872331254493261432 -0.21556615481145435798 -0.20403166598130556553 0.22213568130861408023 -0.7120961112185385522 1.1046442512028464833 -0.29868951666690546354 0.61206425763196303791 -0.60060397043804392148 -0.53594980362729505163 -0.47059581748494228037 -0.34222740908779070157 -0.15785500656903969641 -0.28014230234102505124;-0.27851755998745475473 -0.026044972476198129108 0.28407103539774358758 -0.28421649480073146732 0.10166681172043896819 -0.1117470987481613276 -0.067948740194285525695 0.16376874751853431889 0.123138237362411751 -0.15056918154330098392 0.0023573802380171034881 -0.14166136274147711482 0.18599772252548416041 0.04619197506330840336 0.073933292022731730841 -0.01151504842821190859 0.27217499772338954456 -0.0025621689365161941059 0.18146476750027953906 0.15217642192413502467 0.38267883276209463395 -0.15828022206700390062 0.31397861082455030823 -0.61434439325671896803 -0.14626395529401267637 0.55047866917932375408 0.55750994511970086709 0.5941949562113568728 -0.0041609680410048359434 0.3407602539799033381 0.8219355661893177345 0.45439371389218147224 0.067481422374509020257 -0.071426306426770724833 -0.038298375371532140943 -0.13148175607828602174 -0.24407603101156336023 0.035617483778483727264 -0.09995550668173021347 0.18315214490277698101 0.068021656979332059678 0.36189042460160908421 -0.3552190355880047723 -0.28809032149652569199 0.19619531601104650553 0.055356168879203138111 -0.24376447472313259035 -0.049415729289463021512 0.126030702807254813 -0.077466794967956734141 0.20881873360012062624 -0.27405328906549203394 0.055778258468068726839 -0.23622503028395305802 0.099554120692023753691 0.07857623217358944423 -0.17108598505586000704 -0.0068249864531603095241 0.047873753574652802567 -0.29017655809772308073 0.14113179692658378572 0.10653432526111640544 0.22098822873950274559 0.27430711443863048382 0.084092026320502291648 0.069540535613267090431 0.46734391263786562165 -0.21095272251708621636 0.10690965839048643948 0.1730217493176449961 0.30714464563186016921 0.26315558351986062524 0.17786262625768944901 -0.096767195318491469602;-0.11945236536597976518 0.075756842138365504402 -1.0798099512100798325 -0.00061333978172193985567 -0.062700513026462914579 0.14624004292655462534 0.19254328547549087736 0.16617734397138550495 0.087289723805380400878 0.39827372377898251354 -0.20810676081441178975 -0.14153011278479735169 0.32486735860967069778 0.32457589705003425662 0.19785809472043511259 -0.081166561375394546962 0.35424242263294486444 0.048056049773183125151 -0.15757745098405506745 -0.29744380270924669629 -0.038047086022904678948 0.024495695465423947268 0.3545698994627327072 0.26180551369321342081 1.3208376959710192988 0.15821668880294242898 -1.3953244226601231315 -2.1059915557719754986 0.20386446792567669561 -0.01094124965537534612 -0.20229664267712288428 0.063773235170348080425 0.077566828762140549447 -0.10605735297478274815 0.5104333275596760755 0.67043858946015644218 0.69513821823725485682 0.53463619240657866971 0.6361258219877797826 -0.22845112556301300222 0.21938575748750971384 0.59674284544732980606 -0.019453670968424596754 0.095479000388400334098 0.21386119601433548065 0.13591703198769755634 -0.017312979633582196298 -0.12927749041696315335 0.22734204838581675845 0.041715653471875308034 -0.60618474948342060404 -0.16201421678556321426 0.14493091700419288848 -0.12079373678509022771 -0.21578519639841853284 0.06995149236963439654 -0.084226971207846654255 -0.27205493400816171956 -0.50637748708053498259 0.19608420672391044248 0.20355305221200553634 0.18464780546293743657 -0.21439559991138776307 0.26813992683177223508 -0.50438341711477074902 -0.17738196580458773233 -1.8489084692666455378 0.1387524728636012894 -0.15384681501638414192 0.09147461537173653956 0.33049537105605419907 -0.1646149024801849825 0.21246277928672668844 0.0070810750379180940547;0.31669259331478322173 0.80705105722674908009 -1.0536296945858845131 0.28994211317042095644 0.38068055006707857135 0.17576093149359162116 -0.30744510835831884155 -0.48313210108904292017 0.032742118383809741544 -0.50537159693541233718 0.032910748680796533816 0.53521633209118857355 0.16409265535137509961 -0.36978920308084073376 0.29083626432622328162 -0.43837256087122306036 -0.1317177878552421022 0.03546224028668297501 -0.33090684718667773279 -0.17132325262077333083 -0.13026629141418546998 -0.1424701643863792444 -0.3015821507801239032 -1.0497909663949263059 0.013465127648139025435 3.3352771481585556934 1.857211787478608267 0.19954932664437818879 -0.29583770369700385094 0.14536833645171468032 0.85182350456595423704 0.26335907669113356455 0.029932681325526230148 -0.42072854875918386242 -0.87755721683033172109 -0.3021503915423838782 -0.20583044186122848029 -0.38081462416537320559 0.18229921981974905876 -0.14413207685042275785 0.33399797876211406722 -0.18603834146945610883 0.15802846530490868848 -0.0092152860201780376764 0.025780673511796747821 -0.24608569469636909499 0.18169612501592136145 -0.16948122355566141994 -0.2951865918226228569 -0.15450991549137002568 0.19573285136815904428 0.033070647514621430429 -0.23932995920787794586 -0.020412872334754174342 0.014753654189575643105 -0.097938856016674194493 0.08216997131972449131 -0.22433438262904020766 0.21878243912874956179 0.097822403578708319594 -0.28247252163634745115 0.039452791145234353265 0.098453171724723259617 0.50394413102892110512 0.89891445321853846728 2.1364927834914309024 0.46879957435654673326 0.0055502800901705206735 -0.073832443099501834927 -0.25527899999506126205 -0.23858668649205919121 0.025585443485824581333 -0.43335573913240127419 0.4528069652592547345;-0.4940386805446963514 0.19052767999724432024 1.5096533670155853901 0.26899442424568159593 0.086281418563508099906 -0.28236267619843641308 0.12162657869386803156 -0.036784800891468155681 0.40927707857248485368 0.40169133542129237258 0.040993131566281502953 -0.12863335142283657819 0.23031318670955042149 -0.26301473316509094147 -0.10994627647815734262 -0.004008201934492541807 0.0062827298413964463575 0.28570531237613860931 -0.18897177310309631881 0.36713453142255736417 0.1776890994962016801 -0.0616049229684455385 -0.096261389564365321125 1.1545556131837402258 0.18294881979776100867 -1.304017858407289232 -0.44832763238422651542 -0.16818908250740702282 0.49148077512854010385 -0.39925035141646303405 -0.11816793128014388414 -0.045863581923765023296 0.49678753194917318892 0.17955342610064994879 0.37409728414756238113 0.098802688731054896798 -0.16856199246645850454 -0.14662030315603108432 -0.29310414401716960997 -0.32565735571908088763 -1.0335138408636133089 -0.011119860486826142407 0.095912086293872003684 -0.07964302614803464575 -0.042518714421647257895 -0.20537492157690312444 -0.11767761640332567719 0.22384590191922165703 0.0088026535234499193872 0.15460825579342613034 -0.32674035346941993074 0.042089072172134686656 -0.00041653609978189434695 -0.20028112687508706213 -0.003812478789541995372 0.12729422943554979941 -0.47436035693971007055 0.030173684496052871618 0.095290881330141311012 -0.17081407274397550355 -0.27398668076964244333 -0.041786079246635236817 0.33732224288799306233 0.026252897023418219485 0.23338885792251348739 -0.7666397467084162809 -0.28624899925780944443 -0.32743138662120041538 0.072454191963649369757 -0.88670100619514047313 -0.32079061380880763421 0.01188677067062104617 -0.051217376221552250726 -0.57391202799362772691;0.21662537390841557494 0.62397899743570739428 -1.2698789698596308906 -0.2628813086088038764 0.30875224471347917365 -0.1393811985319534652 0.075839194660457548425 0.47216966162832613163 0.12671984146363618473 -0.0071111192797868559567 0.06614372257824793766 0.0002929373338956568415 0.044421591756673643736 -0.013438317357261718443 0.31113856972971487558 -0.21674498721808199697 0.0050349275130225764827 -0.041597241484530561584 -0.14484555765915307912 0.24683427012759742714 0.13376872301928446896 0.20086324623422333047 0.46958236191853663932 0.22512543462844075703 0.47815453707877153544 0.92402226773602436083 0.095091095056285684928 1.6662118604080173867 -0.4503278881036634762 -0.38728659156338268721 -0.042549601050193029683 -0.6121993409401980113 -0.49916565974206106304 -0.14815508308755379052 -0.27086419679374978964 0.41070026780033414004 0.8572105795993594235 0.49488990239714297781 0.82845657799379834874 -0.1556330004043433024 -0.45848681352103282105 -0.23634014588933133227 0.097834153621873309881 -0.37110180954266203113 -0.099086534981303098224 -0.056966101030025660668 -0.33976069846394574281 0.024806273044537391348 0.09343990400242006833 0.02302941775652279574 -0.060980151819351312292 0.23489682958791943679 -0.037854919597945256571 -0.048689167075883027502 0.18893889133708560712 -0.21248185414255429948 -0.27747922861315199583 -0.037419857820595175957 0.090203778959539446247 0.17327865340828010887 -0.3182925663412812245 -0.027873379355208633551 -0.3424918778107152173 -0.19658280452524978799 1.5171501609916302478 0.42836735901872396992 1.2490250611087017063 0.22205866554312922445 -0.24227020002756366468 -0.16525966500526664826 -0.5661231091965374107 0.46578309825298813696 -0.25432145681788981273 0.45993706198807016161];

% Layer 2
b2 = [-0.80631950258187956582;0.99273609561348141739;0.052330733443160748486;0.62781874115898450572;0.13539298253398038274;0.055247400297785367873;-0.17788187686331427551;-0.38226271897766983532;0.26849250138140751121;-0.53268563254128209472];
LW2_1 = [-2.1697552346315598371 -1.5408967898228416171 -0.67885448590516084266 1.0395582218951322506 -2.705905770277251321 -0.82367049130483838137 -1.271208568933391847 1.3554059041024126842 0.7229877158313813279 2.8585292607145782462;-0.56698745576292286508 -0.48524497428724144843 0.15920297922700363258 1.7428625367768209031 1.4953162324912800951 -0.94647464320888086142 2.0457544084262599959 -1.0337581790074938937 -1.3699533826351193433 -2.7583846454874185739;1.9292059150654601307 -0.48734953833877597829 -2.1256093077941478064 1.6717038912896999836 2.7524309528795898316 0.071071204690574568685 2.0924067647438806539 0.67648865151005210805 -1.798560780516948121 0.68744275802588339364;-2.7521595499701567711 3.6392675933817315581 -0.35244221372138806458 0.28493913267189141525 0.16241481430885001958 0.12669149580192595739 2.6258015022061957922 -1.4578698001256782391 1.5630121700836352439 -1.0202883014574610776;2.0083884400626854649 -1.1532712679985304138 3.1687557489639930353 -2.5904748332133653577 0.13389031253751315642 -0.46239949424003673473 -1.8870545725383645053 -1.0164893599798960899 -0.22137081915392728404 -0.68579558947473229225;1.0229866318646283485 -1.3267360310274634028 4.1719863872745222011 1.5064718328375725775 0.56623136280340824467 -0.32376150048080148958 -1.5509696813183064812 1.5908697565932721218 -1.1298294942775211069 2.567049898994499646;-1.842537359008421527 -1.323104079504573205 -2.5242142046187092674 1.6054887201600427371 3.4178120592976113379 1.5790274325426578717 -1.7418565702051556077 0.49422984313607820628 -2.0618767770036976472 0.76917035510489040195;-0.28344430526994002228 -1.203846234091451084 -2.2029958622179099947 -0.52677642973199179099 -1.6884315783881251871 0.1924205458334679042 -1.6331886315916475105 -2.1467033744797148209 0.90923825102286170985 -0.50638712485306214273;2.1739887494793124212 3.5118732905400844579 0.69799250224161601963 -0.74934663327013140144 -0.61836475214750419305 0.12436322769630837881 2.6871482634680043944 -1.8842195945826838432 1.9895706979673331016 -0.55576603905558397134;-0.47547206186826801444 -0.93248159709726707867 -0.087586205500958691506 -0.57265012728469710801 -1.2150131947001434618 -0.30836146031131739242 -0.82704660132825480456 3.9905563788259654778 -0.39424399974840185212 -3.5788311943647848068];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
